<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.alipay.altershield.change.exe.dal.mapper.ExeNodeMapper">
    <resultMap id="BaseResultMap" type="com.alipay.altershield.change.exe.dal.dataobject.ExeNodeDO">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="node_exe_id" jdbcType="VARCHAR" property="nodeExeId"/>
        <result column="uid" jdbcType="VARCHAR" property="uid"/>
        <result column="trace_id" jdbcType="VARCHAR" property="traceId"/>
        <result column="order_id" jdbcType="VARCHAR" property="orderId"/>
        <result column="coord" jdbcType="VARCHAR" property="coord"/>
        <result column="gmt_create" jdbcType="TIMESTAMP" property="gmtCreate"/>
        <result column="gmt_modified" jdbcType="TIMESTAMP" property="gmtModified"/>
        <result column="status" jdbcType="VARCHAR" property="status"/>
        <result column="change_scene_key" jdbcType="VARCHAR" property="changeSceneKey"/>
        <result column="change_key" jdbcType="VARCHAR" property="changeKey"/>
        <result column="node_type" jdbcType="VARCHAR" property="nodeType"/>
        <result column="change_phase" jdbcType="VARCHAR" property="changePhase"/>
        <result column="param_ref" jdbcType="VARCHAR" property="paramRef"/>
        <result column="rst_ref" jdbcType="VARCHAR" property="rstRef"/>
        <result column="last_trigger_id" jdbcType="VARCHAR" property="lastTriggerId"/>
        <result column="msg" jdbcType="VARCHAR" property="msg"/>
        <result column="executor" jdbcType="VARCHAR" property="executor"/>
        <result column="biz_ext" jdbcType="VARCHAR" property="bizExt"/>
        <result column="search_ext_ref" jdbcType="VARCHAR" property="searchExtRef"/>
        <result column="check_id_info" jdbcType="VARCHAR" property="checkIdInfo"/>
        <result column="start_time" jdbcType="TIMESTAMP" property="startTime"/>
        <result column="finish_time" jdbcType="TIMESTAMP" property="finishTime"/>
        <result column="emergency_flag" jdbcType="VARCHAR" property="emergencyFlag"/>
        <result column="context_ref" jdbcType="VARCHAR" property="contextRef"/>
        <result column="tenant_code" jdbcType="VARCHAR" property="tenantCode"/>
        <result column="from_cloud_id" jdbcType="VARCHAR" property="fromCloudId"/>
        <result column="refer_Id" jdbcType="VARCHAR" property="referId"/>
        <result column="from_tenant_code" jdbcType="VARCHAR" property="fromTenantCode"/>
        <result column="change_content_ref" jdbcType="VARCHAR" property="changeContentRef"/>
        <result column="change_target_ref" jdbcType="VARCHAR" property="changeTargetRef"/>
        <result column="change_effective_info_ref" jdbcType="VARCHAR" property="changeEffectiveInfoRef"/>
        <result column="dispatch_group" jdbcType="VARCHAR" property="dispatchGroup"/>

    </resultMap>
    <sql id="Param_Where_Clause">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <where>
            <foreach collection="oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" prefixOverrides="and" suffix=")">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>

    <sql id="Base_Column_List">
        <include refid="Simple_Base_Column_List" />
        param_ref, rst_ref, last_trigger_id,biz_ext, search_ext_ref, check_id_info,
        context_ref,  from_cloud_id, refer_Id, from_tenant_code, change_content_ref,
        change_effective_info_ref
    </sql>

    <sql id="Simple_Base_Column_List">
        node_exe_id, uid, trace_id, order_id, coord, gmt_create, gmt_modified, status, change_scene_key,
        change_key, node_type, change_phase, msg, executor, start_time, finish_time, emergency_flag, tenant_code
    </sql>
    <select id="selectByOrderId" resultMap="BaseResultMap" parameterType="string">
        select
        <include refid="Simple_Base_Column_List"/>
        from opscloud_exe_node
        where order_id = #{orderId}
    </select>
    <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">

        select
        <include refid="Base_Column_List"/>
        from opscloud_exe_node
        where node_exe_id = #{nodeExeId,jdbcType=VARCHAR}
    </select>

    <select id="lockById" parameterType="java.lang.String" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from opscloud_exe_node
        where node_exe_id = #{nodeExeId,jdbcType=VARCHAR}
        FOR UPDATE
    </select>

    <select id="selectByOrderIdAndType" parameterType="map" resultMap="BaseResultMap">

        select
        <include refid="Base_Column_List"/>
        from opscloud_exe_node
        where  uid = #{uid} and order_id = #{orderId}
        <if test="nodeType != null">
        and node_type = #{nodeType}
        </if>
        order by node_exe_id desc
        limit #{size}
    </select>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from opscloud_exe_node
        where node_exe_id = #{nodeExeId,jdbcType=VARCHAR}
    </delete>

    <insert id="insert" parameterType="com.alipay.altershield.change.exe.dal.dataobject.ExeNodeDO">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into opscloud_exe_node (node_exe_id, trace_id,
        order_id, coord, gmt_create,
        gmt_modified, status, change_scene_key,
        change_key, node_type, change_phase,
        param_ref, rst_ref, last_trigger_id,
        msg, executor, biz_ext,
        search_ext_ref, check_id_info, start_time,
        finish_time, emergency_flag, context_ref,
        tenant_code, from_cloud_id, refer_Id,
        from_tenant_code, change_content_ref, change_target_ref, change_effective_info_ref
        )
        values (#{nodeExeId,jdbcType=VARCHAR},  #{traceId,jdbcType=VARCHAR},
        #{orderId,jdbcType=VARCHAR}, #{coord,jdbcType=VARCHAR}, now(),
        now(), #{status,jdbcType=VARCHAR}, #{changeSceneKey,jdbcType=VARCHAR},
        #{changeKey,jdbcType=VARCHAR}, #{nodeType,jdbcType=VARCHAR}, #{changePhase,jdbcType=VARCHAR},
        #{paramRef,jdbcType=VARCHAR}, #{rstRef,jdbcType=VARCHAR}, #{lastTriggerId,jdbcType=VARCHAR},
        #{msg,jdbcType=VARCHAR}, #{executor,jdbcType=VARCHAR}, #{bizExt,jdbcType=VARCHAR},
        #{searchExtRef,jdbcType=VARCHAR}, #{checkIdInfo,jdbcType=VARCHAR}, #{startTime,jdbcType=TIMESTAMP},
        #{finishTime,jdbcType=TIMESTAMP}, #{emergencyFlag,jdbcType=VARCHAR}, #{contextRef,jdbcType=VARCHAR},
        #{tenantCode,jdbcType=VARCHAR}, #{fromCloudId,jdbcType=VARCHAR}, #{referId,jdbcType=VARCHAR},
        #{fromTenantCode,jdbcType=VARCHAR}, #{changeContentRef,jdbcType=VARCHAR}, #{changeTargetRef,jdbcType=VARCHAR}, #{changeEffectiveInfoRef,jdbcType=VARCHAR}
        )
    </insert>
    <select id="countByParam" resultType="java.lang.Long">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select count(*) from opscloud_exe_node
        <if test="_parameter != null">
            <include refid="Param_Where_Clause"/>
        </if>
    </select>
    <update id="updateByPrimaryKeyWithOldState" parameterType="com.alipay.altershield.change.exe.dal.dataobject.ExeNodeDO">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update opscloud_exe_node
        <set>
            gmt_modified = now(),
            <if test="exeNode.status != null">
                status = #{exeNode.status,jdbcType=VARCHAR},
            </if>
            <if test="exeNode.rstRef != null">
                rst_ref = #{exeNode.rstRef,jdbcType=VARCHAR},
            </if>
            <if test="exeNode.lastTriggerId != null">
                last_trigger_id = #{exeNode.lastTriggerId,jdbcType=VARCHAR},
            </if>
            <if test="exeNode.msg != null">
                msg = #{exeNode.msg,jdbcType=VARCHAR},
            </if>
            <if test="exeNode.executor != null">
                executor = #{exeNode.executor,jdbcType=VARCHAR},
            </if>
            <if test="exeNode.checkIdInfo != null">
                check_id_info = #{exeNode.checkIdInfo,jdbcType=VARCHAR},
            </if>
            <if test="exeNode.startTime != null">
                start_time = #{exeNode.startTime,jdbcType=TIMESTAMP},
            </if>
            <if test="exeNode.finishTime != null">
                finish_time = #{exeNode.finishTime,jdbcType=TIMESTAMP},
            </if>
            <if test="exeNode.contextRef != null">
                context_ref = #{exeNode.contextRef,jdbcType=VARCHAR},
            </if>
            <if test="exeNode.searchExtRef != null">
                search_ext_ref = #{exeNode.searchExtRef,jdbcType=VARCHAR},
            </if>

        </set>
        where node_exe_id = #{exeNode.nodeExeId,jdbcType=VARCHAR} and status in
        <foreach collection="oldStatus" item="item" open="(" separator="," close=")">
            #{item,jdbcType=VARCHAR}
        </foreach>
    </update>


    <update id="updateByPrimaryKey" parameterType="com.alipay.altershield.change.exe.dal.dataobject.ExeNodeDO">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update opscloud_exe_node
        <set>
            gmt_modified = now(),
            <if test="status != null">
                status = #{status,jdbcType=VARCHAR},
            </if>
            <if test="rstRef != null">
                rst_ref = #{rstRef,jdbcType=VARCHAR},
            </if>
            <if test="lastTriggerId != null">
                last_trigger_id = #{lastTriggerId,jdbcType=VARCHAR},
            </if>
            <if test="msg != null">
                msg = #{msg,jdbcType=VARCHAR},
            </if>
            <if test="executor != null">
                executor = #{executor,jdbcType=VARCHAR},
            </if>
            <if test="checkIdInfo != null">
                check_id_info = #{checkIdInfo,jdbcType=VARCHAR},
            </if>
            <if test="startTime != null">
                start_time = #{startTime,jdbcType=TIMESTAMP},
            </if>
            <if test="finishTime != null">
                finish_time = #{finishTime,jdbcType=TIMESTAMP},
            </if>
            <if test="contextRef != null">
                context_ref = #{contextRef,jdbcType=VARCHAR},
            </if>
            <if test="searchExtRef != null">
                search_ext_ref = #{searchExtRef,jdbcType=VARCHAR},
            </if>

        </set>
        where node_exe_id = #{nodeExeId,jdbcType=VARCHAR}
    </update>

</mapper>