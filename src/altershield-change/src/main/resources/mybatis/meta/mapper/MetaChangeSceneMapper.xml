<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.alipay.altershield.change.meta.dal.mapper.MetaChangeSceneMapper">

  <resultMap id="BaseChangeSceneResultMap" type="com.alipay.altershield.change.meta.dal.dataobject.MetaBaseChangeSceneDO">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="VARCHAR" property="id"/>
    <result column="gmt_create" jdbcType="TIMESTAMP" property="gmtCreate"/>
    <result column="gmt_modified" jdbcType="TIMESTAMP" property="gmtModified"/>
    <result column="tenant_code" jdbcType="VARCHAR" property="tenantCode"/>
    <result column="name" jdbcType="VARCHAR" property="name"/>
    <result column="change_scene_key" jdbcType="VARCHAR" property="changeSceneKey"/>
    <result column="owner" jdbcType="VARCHAR" property="owner"/>
    <result column="generation" jdbcType="VARCHAR" property="generation"/>
    <result column="platform_name" jdbcType="VARCHAR" property="platformName"/>
    <result column="status" jdbcType="TINYINT" property="status"/>
  </resultMap>


  <resultMap id="BaseResultMap" extends="BaseChangeSceneResultMap" type="com.alipay.altershield.change.meta.dal.dataobject.MetaChangeSceneDO">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="risk_info" jdbcType="VARCHAR" property="riskInfo"/>
    <result column="change_effective_config_json_ref" jdbcType="VARCHAR" property="changeEffectiveConfigJsonRef"/>
    <result column="description" jdbcType="VARCHAR" property="description"/>
    <result column="callback_config_json_ref" jdbcType="VARCHAR" property="callbackConfigJsonRef"/>
    <result column="scope" jdbcType="VARCHAR" property="scope"/>
    <result column="tags_json_ref" jdbcType="VARCHAR" property="tagsJsonRef"/>
    <result column="server_tenant_code" jdbcType="VARCHAR" property="serverTenantCode"/>
    <result column="change_target_type" jdbcType="VARCHAR" property="changeTargetType"/>
    <result column="change_content_type" jdbcType="VARCHAR" property="changeContentType"/>
  </resultMap>

  <resultMap id="BaseResultAndStepMap" type="com.alipay.altershield.change.meta.dal.dataobject.MetaChangeSceneDO">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="scene_id" jdbcType="VARCHAR" property="id"/>
    <result column="scene_gmt_create" jdbcType="TIMESTAMP" property="gmtCreate"/>
    <result column="scene_gmt_modified" jdbcType="TIMESTAMP" property="gmtModified"/>
    <result column="tenant_code" jdbcType="VARCHAR" property="tenantCode"/>
    <result column="name" jdbcType="VARCHAR" property="name"/>
    <result column="scene_change_scene_key" jdbcType="VARCHAR" property="changeSceneKey"/>
    <result column="owner" jdbcType="VARCHAR" property="owner"/>
    <result column="generation" jdbcType="VARCHAR" property="generation"/>
    <result column="risk_info" jdbcType="VARCHAR" property="riskInfo"/>
    <result column="platform_name" jdbcType="VARCHAR" property="platformName"/>
    <result column="change_effective_config_json_ref" jdbcType="VARCHAR" property="changeEffectiveConfigJsonRef"/>
    <result column="description" jdbcType="VARCHAR" property="description"/>
    <result column="callback_config_json_ref" jdbcType="VARCHAR" property="callbackConfigJsonRef"/>
    <result column="scope" jdbcType="VARCHAR" property="scope"/>
    <result column="tags_json_ref" jdbcType="VARCHAR" property="tagsJsonRef"/>
    <result column="status" jdbcType="TINYINT" property="status"/>
    <result column="server_tenant_code" jdbcType="VARCHAR" property="serverTenantCode"/>
    <result column="scene_effective_target_type" jdbcType="VARCHAR" property="effectiveTargetType"/>
    <result column="scene_change_target_type" jdbcType="VARCHAR" property="changeTargetType"/>
    <result column="scene_change_content_type" jdbcType="VARCHAR" property="changeContentType"/>
    <collection property="changeSteps" ofType="com.alipay.altershield.change.meta.dal.dataobject.MetaChangeStepDO">
      <id column="step_id" jdbcType="VARCHAR" property="id"/>
      <result column="step_name" jdbcType="TIMESTAMP" property="name"/>
      <result column="step_gmt_create" jdbcType="TIMESTAMP" property="gmtCreate"/>
      <result column="step_gmt_modified" jdbcType="TIMESTAMP" property="gmtModified"/>
      <result column="step_change_scene_key" jdbcType="VARCHAR" property="changeSceneKey"/>
      <result column="change_key" jdbcType="VARCHAR" property="changeKey"/>
      <result column="step_type" jdbcType="VARCHAR" property="stepType"/>
      <result column="defence_config_json_ref" jdbcType="VARCHAR" property="defenceConfigJsonRef"/>
      <result column="change_content_type" jdbcType="VARCHAR" property="changeContentType"/>
      <result column="effective_target_type" jdbcType="VARCHAR" property="effectiveTargetType"/>
      <result column="change_target_type" jdbcType="VARCHAR" property="changeTargetType"/>

    </collection>
  </resultMap>



  <sql id="Base_Column_List">
    id, gmt_create, gmt_modified, tldc_tenant_code, name, change_scene_key, owner,
        generation, risk_info, platform_name, change_effective_config_json_ref, description, callback_config_json_ref,
        scope, tags_json_ref, status, server_tldc_tenant_code, effective_target_type, change_content_type,change_target_type
  </sql>

  <select id="selectByParam" resultMap="BaseChangeSceneResultMap" parameterType="com.alipay.altershield.change.meta.dal.dataobject.MetaChangeSceneQueryParam">

    select id,name,platform_name, change_scene_key,status, owner, generation, tldc_tenant_code
    from opscloud_meta_change_scene
    <where>
      <if test="changeSceneName != null">
        AND name like CONCAT('%', #{changeSceneName}, '%')
      </if>
      <if test="changeSceneKey != null">
        AND change_scene_key like CONCAT('%', #{changeSceneKey}, '%')
      </if>
      <if test="platformName != null">
        AND platform_name = #{platformName}
      </if>
      <if test="generation != null">
        AND generation = #{generation}
      </if>
      <if test="owner != null">
        AND owner like CONCAT('%', #{owner}, '%')
      </if>
      <if test="tldcTenantCodes != null">
        AND tldc_tenant_code in
        <foreach collection="tldcTenantCodes" item="item" open="(" separator="," close=")">
          #{item,jdbcType=VARCHAR}
        </foreach>
      </if>
      <if test="status != null">
        AND status = #{status}
      </if>
    </where>
    order by id desc  limit #{offset},#{limit}
  </select>

  <select id="selectByParamCount" resultType="long" parameterType="com.alipay.altershield.change.meta.dal.dataobject.MetaChangeSceneQueryParam">

    select count(*)
    from opscloud_meta_change_scene
    <where>
      <if test="changeSceneName != null">
        AND name like CONCAT('%', #{changeSceneName}, '%')
      </if>
      <if test="changeSceneKey != null">
        AND change_scene_key = #{changeSceneKey}
      </if>
      <if test="platformName != null">
        AND platform_name = #{platformName}
      </if>
      <if test="generation != null">
        AND generation = #{generation}
      </if>
      <if test="tldcTenantCodes != null">
        AND tldc_tenant_code in
        <foreach collection="tldcTenantCodes" item="item" open="(" separator="," close=")">
          #{item,jdbcType=VARCHAR}
        </foreach>
      </if>
      <if test="status != null">
        AND status = #{status}
      </if>
    </where>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">

    select
    <include refid="Base_Column_List"/>
    from opscloud_meta_change_scene
    where id = #{id,jdbcType=VARCHAR}
  </select>


  <select id="selectByPrimaryChangeSceneKey" parameterType="HashMap" resultMap="BaseResultMap">

    select
    <include refid="Base_Column_List"/>
    from opscloud_meta_change_scene
    where
    change_scene_key = #{changeSceneKey,jdbcType=VARCHAR}
  </select>

  <select id="selectWithStepByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultAndStepMap">
    select
      scene.id as scene_id,
      scene.gmt_create as scene_gmt_create,
      scene.gmt_modified as scene_gmt_modified,
      scene.tldc_tenant_code,
      scene.name,
      scene.change_scene_key as scene_change_scene_key,
      scene.owner,
      scene.generation,
      scene.risk_info,
      scene.platform_name,
      scene.change_effective_config_json_ref,
      scene.description,
      scene.callback_config_json_ref,
      scene.scope,
      scene.tags_json_ref,
      scene.status,
      server_tldc_tenant_code,
      scene.effective_target_type as scene_effective_target_type,
      scene.change_content_type as scene_change_content_type,
      scene.change_target_type as scene_change_target_type,
      step.id as step_id,
      step.gmt_create as step_gmt_create,
      step.gmt_modified as step_gmt_modified,
      step.change_scene_key as step_change_scene_key,
      step.change_key,
      step.step_type,
      step.name as step_name,
      step.defence_config_json_ref,
      step.change_content_type as step_change_content_type,
      step.change_target_type as step_change_target_type,
      step.effective_target_type as step_effective_target_type
    from opscloud_meta_change_scene as scene
           left join opscloud_meta_change_step as step
                     on scene.change_scene_key = step.change_scene_key
    where scene.id = #{id,jdbcType=VARCHAR}
  </select>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from opscloud_meta_change_scene
    where id = #{id,jdbcType=VARCHAR}
  </delete>

  <delete id="deleteByChangeSceneKey" parameterType="java.lang.String">

    delete from opscloud_meta_change_scene
    where
      change_scene_key = #{changeSceneKey,jdbcType=VARCHAR}
  </delete>

  <insert id="insert" parameterType="com.alipay.altershield.change.meta.dal.dataobject.MetaChangeSceneDO">

    insert into opscloud_meta_change_scene (id, gmt_create, gmt_modified,
                                            tldc_tenant_code, name,
                                            change_scene_key, owner, generation,
                                            risk_info, platform_name, change_effective_config_json_ref,
                                            description, callback_config_json_ref, scope,
                                            tags_json_ref, status, server_tldc_tenant_code,
                                            effective_target_type, change_content_type, change_target_type)
    values (#{id,jdbcType=VARCHAR}, now(), now(),
            #{tldcTenantCode,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR},
            #{changeSceneKey,jdbcType=VARCHAR}, #{owner,jdbcType=VARCHAR}, #{generation,jdbcType=VARCHAR},
            #{riskInfo,jdbcType=VARCHAR}, #{platformName,jdbcType=VARCHAR}, #{changeEffectiveConfigJsonRef,jdbcType=VARCHAR},
            #{description,jdbcType=VARCHAR}, #{callbackConfigJsonRef,jdbcType=VARCHAR}, #{scope,jdbcType=VARCHAR},
            #{tagsJsonRef,jdbcType=VARCHAR}, #{status,jdbcType=TINYINT}, #{serverTldcTenantCode,jdbcType=VARCHAR},
            #{effectiveTargetType,jdbcType=VARCHAR}, #{changeContentType,jdbcType=VARCHAR}, #{changeTargetType,jdbcType=VARCHAR})
  </insert>




  <update id="updateByPrimaryKey" parameterType="com.alipay.altershield.change.meta.dal.dataobject.MetaChangeSceneDO">
    update opscloud_meta_change_scene
    set gmt_create = now(),
        tldc_tenant_code = #{tldcTenantCode,jdbcType=VARCHAR},
        name = #{name,jdbcType=VARCHAR},
        owner = #{owner,jdbcType=VARCHAR},
        generation = #{generation,jdbcType=VARCHAR},
        risk_info = #{riskInfo,jdbcType=VARCHAR},
        platform_name = #{platformName,jdbcType=VARCHAR},
        change_effective_config_json_ref = #{changeEffectiveConfigJsonRef,jdbcType=VARCHAR},
        description = #{description,jdbcType=VARCHAR},
        callback_config_json_ref = #{callbackConfigJsonRef,jdbcType=VARCHAR},
        scope = #{scope,jdbcType=VARCHAR},
        tags_json_ref = #{tagsJsonRef,jdbcType=VARCHAR},
        status = #{status,jdbcType=TINYINT},
        server_tldc_tenant_code = #{serverTldcTenantCode,jdbcType=VARCHAR},
        effective_target_type = #{effectiveTargetType,jdbcType=VARCHAR},
        change_content_type = #{changeContentType,jdbcType=VARCHAR},
        change_target_type = #{changeTargetType,jdbcType=VARCHAR}
    where id = #{id,jdbcType=VARCHAR}
  </update>



  <update id="updateGeneration" parameterType="java.util.Map">
    update opscloud_meta_change_scene
    set gmt_create = now(),
        generation = #{generation,jdbcType=VARCHAR},
        where id = #{id,jdbcType=VARCHAR}
  </update>

  <select id="querySceneMainInfo"
          resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List"/>
    from opscloud_meta_change_scene
  </select>
  <select id="getFullEntity" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List"/>
    from opscloud_meta_change_scene
    where change_scene_key = #{changeSceneKey}
  </select>

</mapper>